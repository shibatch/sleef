set(SRC_DIR "@CMAKE_CURRENT_SOURCE_DIR@")
set(BIN_DIR "@CMAKE_BINARY_DIR@")

set(MKRENAME_PARAMS "@MKRENAME_PARAMS@")

# Do not run for empty parameters
if(MKRENAME_PARAMS)
  execute_process(
    COMMAND ./mkrename ${MKRENAME_PARAMS}
    OUTPUT_VARIABLE MKRENAME_OUTPUT)
endif()

# Workaround: temporary copy of sleeflibm.h.org
execute_process(
  COMMAND ${CMAKE_COMMAND} -E copy
  ${SRC_DIR}/sleeflibm.h.org
  ${SRC_DIR}/sleeflibm.h.in)
file(APPEND ${SRC_DIR}/sleeflibm.h.in "\n@MKRENAME_OUTPUT@\n#undef IMPORT\n#endif")

configure_file(
  ${SRC_DIR}/sleeflibm.h.in
  ${BIN_DIR}/include/sleef.h @ONLY)
